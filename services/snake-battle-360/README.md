# Snake Battle（联机版）

本仓库已改造成 **可联机对战** 的“类 Slither.io”贪吃蛇大作战，并且对手机端做了 **响应式布局 + 双侧虚拟摇杆** 适配。

## 功能概览

- **360° 自由移动**：蛇始终向前移动，通过摇杆控制转向（有限角速度，手感更“丝滑”）
- **硬边界地图**：超大矩形世界，撞墙即死
- **击杀收益**：死亡蛇分解为大量发光食物粒子；吃掉可获得其生前长度约 **1/3~1/4** 的成长收益

- **单机模式**：本地 1 玩家 + 10 AI
- **联机模式**：服务端权威同步
  - 默认生成 12 条 AI 蛇
  - 玩家进入后可 **任选一条 AI 蛇接管**（AI → 真人）
  - 断线后自动把蛇交还给 AI
  - **暂停投票**：任意真人玩家可发起“暂停/继续”请求，需所有真人玩家 **同意** 才生效（15 秒超时）
- **手机端**：画布自适应缩放，左右两侧提供透明虚拟摇杆（触控友好，跟手低延迟）

### 玩法规则（关键）

- **360° 自由转向**：蛇始终持续前进，摇杆仅控制转向角速度（有平滑限制）
- **硬边界墙体**：撞墙立即死亡
- **碰撞死亡**：蛇头碰到任意其他蛇身体立即死亡
- **死亡爆裂**：死亡蛇分解为可吸收粒子（总收益约为其生前长度的 1/4~1/3）

---

## 运行环境

- Node.js 18+（推荐 20+）
- 包管理器：pnpm（推荐）或 npm

---

## 本地开发（推荐）

### 1）安装依赖

```bash
pnpm install
```

如果你不用 pnpm：

```bash
npm install
```

### 2）启动前端（Vite）

```bash
pnpm dev
```

或：

```bash
npm run dev
```

默认打开：

- http://localhost:3000

### 3）启动联机后端（WebSocket / 生产静态）

另开一个终端：

```bash
pnpm dev:server
```

或：

```bash
npm run dev:server
```

后端默认端口：

- http://localhost:3001/health
- ws://localhost:3001/ws

然后在首页点 **联机对战** 即可。

> 如果你想把联机后端端口改掉：设置 `PORT=xxxx`（开发默认 3001，生产默认 3000）。

---

## 生产构建（单端口）

```bash
pnpm build
pnpm start
```

或：

```bash
npm run build
npm start
```

生产模式下：

- 后端会在 **同一个端口** 提供静态页面 + WebSocket
- WebSocket 地址为：`ws(s)://<host>/ws`

---

## 手机端说明

- 进入游戏后，画布会自动按屏幕宽度缩放
- 手机端会在 **左下角/右下角** 出现透明虚拟摇杆（两侧都能控，方便左右手）
- 如果手机浏览器“拖动页面”影响手感，可把页面加到桌面（PWA/全屏模式），体验更接近原生手游

---

## 自定义背景与 BGM（可选）

你可以自备资源文件：

- 背景图：`client/public/background/1.png`
- BGM：`client/public/audio/bgm2.mp3`

游戏进入（单机/联机）后会自动加载背景图并尝试播放 BGM。

### 背景图建议规格

画布尺寸为 **800×600（4:3）**，背景会以 *cover* 方式铺满（可能会裁剪边缘）。为了观感最好，建议：

- **比例：4:3**（最推荐）
- **分辨率：1600×1200 或 1920×1440**（兼顾清晰与体积）
- **文件体积：尽量 ≤ 1MB**（PNG 建议压缩；如果你愿意也可改成 WebP）

> 你也可以用 16:9 图，但会被裁剪到 4:3 的可视区域。

### BGM 说明

移动端浏览器可能会拦截自动播放，因此如果没播放成功，页面顶部会出现 **“🎵 开启音乐”** 按钮，点一下即可。

---

## 可选：自定义 WebSocket 地址

如果你要部署到自己的大厅/网关后面，可以在前端配置环境变量：

- `VITE_WS_URL=ws://your-host/ws`

开发时不配置则默认连接 `ws://<hostname>:3001/ws`。
