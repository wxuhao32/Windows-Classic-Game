<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>接龙纸牌</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="app" id="app" aria-label="接龙纸牌（Klondike）">
    <header class="topbar">
      <div class="topbar__left">
        <div class="brand">接龙纸牌</div>
      </div>
      <div class="topbar__right">
        <button class="btn" id="btnNew" type="button">新开一局</button>
        <button class="btn" id="btnUndo" type="button" disabled>撤销</button>
        <button class="btn" id="btnAuto" type="button">自动收牌</button>
        <button class="btn" id="btnRules" type="button">规则</button>
      </div>
    </header>

    <main class="board" id="board">
      <section class="row row--top" aria-label="上方区域">
        <div class="pile-group pile-group--left">
          <div class="pile pile--stock" id="stock" data-drop="stock" aria-label="牌库（点击翻牌）">
            <div class="pile__slot"></div>
            <div class="pile__hint">牌库</div>
          </div>
          <div class="pile pile--waste" id="waste" data-drop="waste" aria-label="翻牌堆">
            <div class="pile__slot"></div>
            <div class="pile__hint">翻牌</div>
          </div>
        </div>

        <div class="pile-group pile-group--right" aria-label="收集区">
          <div class="pile pile--foundation" data-drop="foundation" data-i="0" aria-label="收集区 1">
            <div class="pile__slot"></div>
            <div class="pile__hint">♠</div>
          </div>
          <div class="pile pile--foundation" data-drop="foundation" data-i="1" aria-label="收集区 2">
            <div class="pile__slot"></div>
            <div class="pile__hint">♥</div>
          </div>
          <div class="pile pile--foundation" data-drop="foundation" data-i="2" aria-label="收集区 3">
            <div class="pile__slot"></div>
            <div class="pile__hint">♦</div>
          </div>
          <div class="pile pile--foundation" data-drop="foundation" data-i="3" aria-label="收集区 4">
            <div class="pile__slot"></div>
            <div class="pile__hint">♣</div>
          </div>
        </div>
      </section>

      <section class="row row--tableau" aria-label="桌面七列">
        <div class="tableau" id="tableau" role="list" aria-label="桌面列">
          <!-- columns injected by JS -->
        </div>
      </section>
    </main>

    <footer class="statusbar" aria-label="状态栏">
      <div id="statusText" class="statusbar__text">提示：手机上可“点选牌→再点目标位置”移动。</div>
    </footer>
  </div>

  <!-- 规则弹窗 -->
  <div class="modal" id="rulesModal" aria-hidden="true" role="dialog" aria-label="规则">
    <div class="modal__mask" data-close="rules"></div>
    <div class="modal__card">
      <div class="modal__head">
        <div class="modal__title">游戏规则（Klondike 接龙）</div>
        <button class="iconbtn" type="button" data-close="rules" aria-label="关闭">✕</button>
      </div>
      <div class="modal__body rules">
        <h3>一、目标（怎么才算赢）</h3>
        <p>把 <b>52 张牌</b>全部移动到右上角 4 个「收集区（Foundation）」里。每个收集区只收一种花色，并且必须按点数从小到大依次摆放：</p>
        <div class="rules__seq">A → 2 → 3 → 4 → 5 → 6 → 7 → 8 → 9 → 10 → J → Q → K</div>
        <p>当 4 个收集区都摆到 <b>K</b>（每个 13 张）时，你就胜利。</p>

        <h3>二、牌的点数与颜色</h3>
        <ul>
          <li><b>点数顺序</b>：A(最小) &lt; 2 &lt; 3 … &lt; 10 &lt; J &lt; Q &lt; K(最大)</li>
          <li><b>红色</b>：♥（红桃）、♦（方块）</li>
          <li><b>黑色</b>：♠（黑桃）、♣（梅花）</li>
        </ul>

        <h3>三、四个区域分别是干什么的</h3>
        <ul>
          <li><b>牌库（Stock）</b>：左上角盖着的牌。点击一次翻出 1 张到「翻牌堆」。</li>
          <li><b>翻牌堆（Waste）</b>：牌库翻出来的牌。<b>只能操作最上面一张</b>。</li>
          <li><b>收集区（Foundation）</b>：右上 4 个空位。只放同花色，并且按 <b>A→K</b> 递增。</li>
          <li><b>桌面七列（Tableau）</b>：下方 7 列牌。这里是你“整理牌、翻开暗牌”的主要区域。</li>
        </ul>

        <h3>四、核心规则（最重要）</h3>

        <h4>1）收集区（Foundation）的摆放规则：同花色递增</h4>
        <ul>
          <li>每个收集区 <b>必须从 A 开始</b>。</li>
          <li>之后只能放 <b>同花色</b> 且 <b>点数 +1</b> 的牌，例如：</li>
        </ul>
        <div class="rules__examples">
          <div>♠A 上面只能放 ♠2；♠2 上面只能放 ♠3；…；♠Q 上面只能放 ♠K</div>
          <div>♥A 上面只能放 ♥2；♦A 上面只能放 ♦2；♣A 上面只能放 ♣2</div>
        </div>

        <h4>2）桌面列（Tableau）的摆放规则：红黑交替、点数递减</h4>
        <ul>
          <li>桌面列之间摆牌时：必须 <b>颜色交替</b>（红↔黑）且 <b>点数 -1</b>。</li>
          <li>简单记法：<b>把“小一号、相反颜色”的牌放上去</b>。</li>
        </ul>
        <div class="rules__seq">K ⇄ Q ⇄ J ⇄ 10 ⇄ 9 ⇄ 8 ⇄ 7 ⇄ 6 ⇄ 5 ⇄ 4 ⇄ 3 ⇄ 2 ⇄ A（颜色必须红黑交替）</div>
        <div class="rules__examples">
          <div>10♠（黑）上面可以放 9♥ 或 9♦（红）</div>
          <div>2♥（红）上面可以放 A♠ 或 A♣（黑）</div>
          <div>Q♦（红）上面可以放 J♠ 或 J♣（黑）</div>
        </div>

        <h4>3）空列规则：只能放 K</h4>
        <ul>
          <li>当某一列被清空后，这个空位只能放 <b>K（国王）</b>（可以连同它下面的一整串一起移动）。</li>
        </ul>

        <h4>4）翻开暗牌（盖牌）</h4>
        <ul>
          <li>桌面某列最上面如果是盖着的牌，且它上面没有任何明牌时，<b>点击盖牌即可翻开</b>。</li>
          <li>玩法关键：尽量通过移动明牌去“露出”更多盖牌。</li>
        </ul>

        <h3>五、怎么操作（本游戏的玩法）</h3>
        <ul>
          <li><b>拖拽移动</b>：拖动一张牌（或桌面列的一整段顺序牌）到目标位置松开。</li>
          <li><b>点选移动（手机推荐）</b>：先点一张可移动牌让它高亮，再点目标堆/目标列尝试放置。</li>
          <li><b>双击自动入收集区（桌面端）</b>：双击顶牌，若满足规则会自动送入收集区。</li>
          <li><b>自动收牌</b>：把当前能直接进收集区的牌尽量送过去（不一定总是最优策略）。</li>
          <li><b>撤销</b>：回退一步操作。</li>
        </ul>

        <h3>六、入门打法（不懂怎么赢就按这个做）</h3>
        <ol>
          <li>先不停点击 <b>牌库</b> 翻牌，优先把 <b>A、2、3</b> 这种低牌送进收集区（能送就送）。</li>
          <li>在桌面 7 列里优先做两件事：<b>露出盖牌</b>、<b>制造空列</b>（空列能放 K 很关键）。</li>
          <li>当你能把一张牌送进收集区时，一般是好事；但如果送进去会导致你无法继续移动、露不出盖牌，也可以先不送。</li>
          <li>胜利的最终形态就是：4 个收集区都摆到 <b>K</b>，桌面和翻牌堆都空。</li>
        </ol>
</div>
      <div class="modal__foot">
        <button class="btn btn--primary" type="button" data-close="rules">知道了</button>
      </div>
    </div>
  </div>

  <!-- 胜利弹窗 -->
  <div class="modal" id="winModal" aria-hidden="true" role="dialog" aria-label="胜利">
    <div class="modal__mask" data-close="win"></div>
    <div class="modal__card">
      <div class="modal__head">
        <div class="modal__title">恭喜你胜利！</div>
        <button class="iconbtn" type="button" data-close="win" aria-label="关闭">✕</button>
      </div>
      <div class="modal__body">
        <p>你已将所有牌收集到收集区。</p>
      </div>
      <div class="modal__foot">
        <button class="btn" type="button" data-close="win">继续看看</button>
        <button class="btn btn--primary" id="btnWinNew" type="button">新开一局</button>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
